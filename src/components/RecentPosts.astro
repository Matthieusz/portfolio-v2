---
import Hashtag from "@/icons/Hashtag.astro";
import { getCollection } from "astro:content";

const posts = (await getCollection("posts")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
const recentPosts = posts.slice(0, 5);
---

<div
  class="bg-card border-border relative flex h-full flex-col gap-3 overflow-hidden rounded-lg border p-4"
>
  <div class="relative z-10">
    <h3
      class="text-muted-foreground flex items-center justify-between gap-2 text-xs font-medium tracking-wider uppercase"
    >
      <div class="flex items-center gap-2">
        <Hashtag size={20} color="var(--primary)" />
        Recent Posts
      </div>
      <span class="group relative inline-flex items-center">
        <span class="sr-only">Built with Astro content collections</span>
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="var(--foreground)"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="icon icon-tabler icons-tabler-outline icon-tabler-info-circle"
        >
          <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
          <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"></path>
          <path d="M12 9h.01"></path>
          <path d="M11 12h1v4h1"></path>
        </svg>
        <span
          class="bg-background text-foreground pointer-events-none absolute top-1/2 right-full z-10 mr-2 -translate-y-1/2 rounded px-2 py-1 text-[0.65rem] whitespace-nowrap opacity-0 shadow transition-opacity duration-150 group-hover:opacity-100"
        >
          Built with Astro content collections
        </span>
      </span>
    </h3>
  </div>

  <div class="relative z-10 flex h-full flex-col gap-3">
    {
      recentPosts.length > 0 ? (
        <div class="flex flex-col gap-3">
          {recentPosts.map((post) => (
            <div class="flex items-start justify-between gap-4">
              <div class="w-full min-w-0">
                <div class="flex items-center justify-between gap-2">
                  <div class="text-muted-foreground text-xs">
                    <time datetime={post.data.date.toISOString()}>
                      {post.data.date.toLocaleDateString()}
                    </time>
                  </div>
                  <div class="text-muted-foreground flex flex-wrap items-center justify-end gap-1 text-[0.65rem]">
                    {post.data.tags.slice(0, 2).map((tag) => (
                      <span class="bg-muted rounded px-1.5 py-0.5 uppercase">
                        {tag}
                      </span>
                    ))}
                  </div>
                </div>
                <div class="mt-1 flex items-center justify-between gap-2">
                  <a
                    href={`/blog/${post.slug}`}
                    class="text-foreground hover:text-primary block truncate text-sm font-medium transition-colors"
                  >
                    {post.data.title}
                  </a>
                </div>
              </div>
            </div>
          ))}
        </div>
      ) : (
        <div class="text-muted-foreground flex items-center gap-3">
          <span>No posts available.</span>
        </div>
      )
    }
  </div>
</div>
