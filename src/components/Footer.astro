---
import Github from "@/icons/Github.astro";
import Hourglass from "@/icons/Hourglass.astro";
import Linkedin from "@/icons/Linkedin.astro";

const currentYear = new Date().getFullYear();
---

<footer class="border-border mt-auto border-t py-4 text-sm">
  <div class="flex flex-col items-center justify-between gap-4 md:flex-row">
    <!-- Left side: Copyright & Status -->
    <div class="flex flex-col items-center gap-2 md:flex-row">
      <div>
        <span>Â© {currentYear} Mateusz Irski</span>
      </div>
      <span class="text-muted-foreground/50 hidden md:block">-</span>
      <div>
        <span class="text-muted-foreground flex items-center gap-2">
          <span class="relative flex size-2">
            <span
              class="absolute inline-flex h-full w-full animate-ping rounded-full bg-green-400 opacity-75"
            ></span>
            <span class="relative inline-flex size-2 rounded-full bg-green-500"
            ></span>
          </span>
          <a
            href="https://uptime.informati.dev/status/overview"
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-foreground transition-colors"
          >
            All Services Nominal
          </a>
        </span>
      </div>
    </div>

    <!-- Right side: Time, Social Links -->
    <div class="flex items-center gap-3">
      <!-- Time on Site -->
      <span
        class="text-muted-foreground flex items-center gap-2 tabular-nums"
        title="Time spent looking through my site"
      >
        <Hourglass size={16} color="var(--muted-foreground)" />
        <span id="footer-time">00:00:00</span>
      </span>

      <span class="text-muted-foreground/50">-</span>

      <!-- Social Links -->
      <div class="flex items-center gap-2">
        <a
          href="https://github.com/Matthieusz"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-foreground transition-colors"
          aria-label="GitHub"
        >
          <Github size={20} color="var(--foreground)" />
        </a>
        <a
          href="https://www.linkedin.com/in/mateusz-irski-61a593248/"
          target="_blank"
          rel="noopener noreferrer"
          class="hover:text-foreground transition-colors"
          aria-label="LinkedIn"
        >
          <Linkedin size={20} color="var(--foreground)" />
        </a>
      </div>
    </div>
  </div>
</footer>

<script>
  const STORAGE_KEY = "site-time-spent";

  function getStoredTime(): number {
    const stored = localStorage.getItem(STORAGE_KEY);
    return stored ? parseInt(stored, 10) : 0;
  }

  function formatTime(totalSeconds: number): string {
    const hours = Math.floor(totalSeconds / 3600);
    const minutes = Math.floor((totalSeconds % 3600) / 60);
    const seconds = totalSeconds % 60;
    return [hours, minutes, seconds]
      .map((n) => n.toString().padStart(2, "0"))
      .join(":");
  }

  const sessionStart = Date.now();
  const storedTime = getStoredTime();
  let intervalId: ReturnType<typeof setInterval> | null = null;

  function updateDisplay() {
    const timeEl = document.getElementById("footer-time");
    if (timeEl) {
      const sessionSeconds = Math.floor((Date.now() - sessionStart) / 1000);
      const totalSeconds = storedTime + sessionSeconds;
      timeEl.textContent = formatTime(totalSeconds);
      localStorage.setItem(STORAGE_KEY, totalSeconds.toString());
    }
  }

  function startTimer() {
    if (intervalId) {
      clearInterval(intervalId);
    }
    updateDisplay();
    intervalId = setInterval(updateDisplay, 1000);
  }

  function stopTimer() {
    if (intervalId) {
      clearInterval(intervalId);
      intervalId = null;
    }
  }

  document.addEventListener("astro:page-load", startTimer);
  document.addEventListener("astro:before-swap", stopTimer);
  window.addEventListener("beforeunload", stopTimer);
</script>
