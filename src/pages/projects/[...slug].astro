---
import Github from "@/icons/Github.astro";
import Link from "@/icons/Link.astro";
import MainLayout from "@/layouts/MainLayout.astro";
import { getCollection, getEntry } from "astro:content";

export const getStaticPaths = async () => {
  const projects = await getCollection("projects");

  return projects.map((project) => ({
    params: { slug: project.slug },
  }));
};

const { slug } = Astro.params;

const project = await getEntry("projects", slug ?? "");

if (!project) {
  return Astro.redirect("/projects");
}

const { Content } = await project.render();
const { date, demoLink, repoLink, tags, title } = project.data;
---

<MainLayout>
  <article
    class="bg-card border-border mx-auto mb-12 max-w-4xl overflow-hidden rounded-lg border p-6"
  >
    {
      project.data.image ? (
        <img
          src={project.data.image.src}
          alt={project.data.imageAlt ?? "Project image"}
          width={800}
          height={400}
          loading="lazy"
          transition:name={`project-${project.slug}-image`}
          class="h-64 w-full object-cover"
        />
      ) : (
        <div class="bg-muted text-muted-foreground flex h-64 w-full items-center justify-center text-sm">
          No image available
        </div>
      )
    }
    <div class="p-6">
      <header class="mb-6 space-y-3">
        <h1
          class="text-3xl font-bold"
          transition:name={`project-${project.slug}-title`}
        >
          {title}
        </h1>
        <div class="flex flex-wrap items-center gap-3 text-sm">
          <time datetime={date.toISOString()}>{date.toLocaleDateString()}</time>
          {
            repoLink ? (
              <a
                class="link-underline flex items-center gap-1"
                href={repoLink}
                rel="noopener"
                target="_blank"
              >
                <Github size={16} color="currentColor" />
                Repository
              </a>
            ) : null
          }
          {
            demoLink ? (
              <a
                class="link-underline flex items-center gap-1"
                href={demoLink}
                rel="noopener"
                target="_blank"
              >
                <Link size={16} color="currentColor" />
                Live demo
              </a>
            ) : null
          }
        </div>
        <div class="flex flex-wrap gap-2">
          {
            tags.map((tag) => (
              <span class="bg-secondary text-secondary-foreground rounded-full px-3 py-1 text-xs">
                {tag}
              </span>
            ))
          }
        </div>
      </header>

      <div class="prose prose-invert max-w-none">
        <Content />
      </div>
    </div>
  </article>
</MainLayout>
